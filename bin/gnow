#!/bin/bash

function green  { echo -e "\e[32m$*\e[m"; }
function red { echo -e "\e[31m$*\e[m"; }
function yellow { echo -e "\e[33m$*\e[m"; }

MESSAGE=${1}

GIT_STATUS=`git status -s`
DATE=`date +'%Y-%m-%d %T'`
BRANCH=`git rev-parse --abbrev-ref HEAD`
BRANCH_EXIST=`git branch`

# バージョン表示
VERSION=`cat VERSION`

while getopts vV OPT
do
  case $OPT in
    "v" ) FLG_v="TRUE" ; VER_NUM="$VERSION" ;;
    "V" ) FLG_v="TRUE" ; VER_NUM="$VERSION" ;;
  esac
done

if [ "${FLG_v}" = "TRUE" ]; then
    echo ${VERSION}
    exit 0
fi

# コミットメッセージ引数が無い場合は日付とステータスをメッセージとする
if [ -z ${MESSAGE} ]; then
    MESSAGE="${DATE} ${GIT_STATUS}"
fi

# ローカルのブランチが存在しない初回pushとみられる場合はmasterにpushする
if [ -z ${BRANCH_EXIST} ]; then
    BRANCH=master
    yellow 'Initial Commit'
fi

yellow 'message:'
echo ${MESSAGE}
yellow 'branch:'
echo ${BRANCH}
green "Ready? 'no' or press ENTER"

read input

if [ "${input}" = 'no' ] || [ "${input}" = 'NO' ] || [ "${input}" = 'n' ]; then
    exit 0
else
    git add -A

    git commit -m "${MESSAGE}"

    git push origin ${BRANCH}
fi

exit 0
