#!/bin/bash

function green  { echo -e "\e[32m$*\e[m"; }
function red { echo -e "\e[31m$*\e[m"; }
function yellow { echo -e "\e[33m$*\e[m"; }

MESSAGE=${1}

GIT_STATUS=`git status -s`
DATE=`date +'%Y-%m-%d %T'`
BRANCH=`git rev-parse --abbrev-ref HEAD`

# コミットメッセージ引数が無い場合は日付とステータスをメッセージとする
if [ -z ${MESSAGE} ]; then
    MESSAGE="${DATE} ${GIT_STATUS}"
fi

# ローカルのブランチが存在しない初回pushとみられる場合はmasterにpushする
if [ ${BRANCH} = 'HEAD']; then
    BRANCH=master
fi

yellow 'message:'
echo ${MESSAGE}
yellow 'branch:'
echo ${BRANCH}
green "Ready? 'no' or press ENTER"

read input

if [ "${input}" = 'no' ] || [ "${input}" = 'NO' ] || [ "${input}" = 'n' ]; then
    exit 0
else
    git add -A

    git commit -m "${MESSAGE}"

    git push origin ${BRANCH}
fi

exit 0
